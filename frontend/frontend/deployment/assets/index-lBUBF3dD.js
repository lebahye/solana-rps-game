import{u as ee,t as te,r as ne,P as ie,T as V,V as I}from"./solana-CpPL8tnJ.js";import{g as Q}from"./vendor-D44yUz92.js";import{v as re}from"./v4-CtRu48qb.js";import"./buffer-ClfaVKLN.js";var F={exports:{}},B;function se(){return B||(B=1,function(d){var n=Object.prototype.hasOwnProperty,e="~";function t(){}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(e=!1));function i(u,a,r){this.fn=u,this.context=a,this.once=r||!1}function s(u,a,r,c,y){if(typeof r!="function")throw new TypeError("The listener must be a function");var w=new i(r,c||u,y),o=e?e+a:a;return u._events[o]?u._events[o].fn?u._events[o]=[u._events[o],w]:u._events[o].push(w):(u._events[o]=w,u._eventsCount++),u}function h(u,a){--u._eventsCount===0?u._events=new t:delete u._events[a]}function f(){this._events=new t,this._eventsCount=0}f.prototype.eventNames=function(){var a=[],r,c;if(this._eventsCount===0)return a;for(c in r=this._events)n.call(r,c)&&a.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(r)):a},f.prototype.listeners=function(a){var r=e?e+a:a,c=this._events[r];if(!c)return[];if(c.fn)return[c.fn];for(var y=0,w=c.length,o=new Array(w);y<w;y++)o[y]=c[y].fn;return o},f.prototype.listenerCount=function(a){var r=e?e+a:a,c=this._events[r];return c?c.fn?1:c.length:0},f.prototype.emit=function(a,r,c,y,w,o){var _=e?e+a:a;if(!this._events[_])return!1;var l=this._events[_],m=arguments.length,g,v;if(l.fn){switch(l.once&&this.removeListener(a,l.fn,void 0,!0),m){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,r),!0;case 3:return l.fn.call(l.context,r,c),!0;case 4:return l.fn.call(l.context,r,c,y),!0;case 5:return l.fn.call(l.context,r,c,y,w),!0;case 6:return l.fn.call(l.context,r,c,y,w,o),!0}for(v=1,g=new Array(m-1);v<m;v++)g[v-1]=arguments[v];l.fn.apply(l.context,g)}else{var S=l.length,p;for(v=0;v<S;v++)switch(l[v].once&&this.removeListener(a,l[v].fn,void 0,!0),m){case 1:l[v].fn.call(l[v].context);break;case 2:l[v].fn.call(l[v].context,r);break;case 3:l[v].fn.call(l[v].context,r,c);break;case 4:l[v].fn.call(l[v].context,r,c,y);break;default:if(!g)for(p=1,g=new Array(m-1);p<m;p++)g[p-1]=arguments[p];l[v].fn.apply(l[v].context,g)}}return!0},f.prototype.on=function(a,r,c){return s(this,a,r,c,!1)},f.prototype.once=function(a,r,c){return s(this,a,r,c,!0)},f.prototype.removeListener=function(a,r,c,y){var w=e?e+a:a;if(!this._events[w])return this;if(!r)return h(this,w),this;var o=this._events[w];if(o.fn)o.fn===r&&(!y||o.once)&&(!c||o.context===c)&&h(this,w);else{for(var _=0,l=[],m=o.length;_<m;_++)(o[_].fn!==r||y&&!o[_].once||c&&o[_].context!==c)&&l.push(o[_]);l.length?this._events[w]=l.length===1?l[0]:l:h(this,w)}return this},f.prototype.removeAllListeners=function(a){var r;return a?(r=e?e+a:a,this._events[r]&&h(this,r)):(this._events=new t,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=e,f.EventEmitter=f,d.exports=f}(F)),F.exports}var ae=se();const oe=Q(ae);var H,G;function ce(){if(G)return H;G=1;function d(n){if(n.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var i=0;i<n.length;i++){var s=n.charAt(i),h=s.charCodeAt(0);if(e[h]!==255)throw new TypeError(s+" is ambiguous");e[h]=i}var f=n.length,u=n.charAt(0),a=Math.log(f)/Math.log(256),r=Math.log(256)/Math.log(f);function c(o){if(o instanceof Uint8Array||(ArrayBuffer.isView(o)?o=new Uint8Array(o.buffer,o.byteOffset,o.byteLength):Array.isArray(o)&&(o=Uint8Array.from(o))),!(o instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(o.length===0)return"";for(var _=0,l=0,m=0,g=o.length;m!==g&&o[m]===0;)m++,_++;for(var v=(g-m)*r+1>>>0,S=new Uint8Array(v);m!==g;){for(var p=o[m],x=0,M=v-1;(p!==0||x<l)&&M!==-1;M--,x++)p+=256*S[M]>>>0,S[M]=p%f>>>0,p=p/f>>>0;if(p!==0)throw new Error("Non-zero carry");l=x,m++}for(var b=v-l;b!==v&&S[b]===0;)b++;for(var z=u.repeat(_);b<v;++b)z+=n.charAt(S[b]);return z}function y(o){if(typeof o!="string")throw new TypeError("Expected String");if(o.length===0)return new Uint8Array;for(var _=0,l=0,m=0;o[_]===u;)l++,_++;for(var g=(o.length-_)*a+1>>>0,v=new Uint8Array(g);o[_];){var S=o.charCodeAt(_);if(S>255)return;var p=e[S];if(p===255)return;for(var x=0,M=g-1;(p!==0||x<m)&&M!==-1;M--,x++)p+=f*v[M]>>>0,v[M]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");m=x,_++}for(var b=g-m;b!==g&&v[b]===0;)b++;for(var z=new Uint8Array(l+(g-b)),Z=l;b!==g;)z[Z++]=v[b++];return z}function w(o){var _=y(o);if(_)return _;throw new Error("Non-base"+f+" character")}return{encode:c,decodeUnsafe:y,decode:w}}return H=d,H}var j,J;function le(){return J||(J=1,j=ce()("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")),j}var de=le();const A=Q(de);function $(d){return d.version===void 0}function P(d){return $(d)?d.serialize({verifySignatures:!1,requireAllSignatures:!1}):d.serialize()}var X=function(d,n,e,t){function i(s){return s instanceof e?s:new e(function(h){h(s)})}return new(e||(e=Promise))(function(s,h){function f(r){try{a(t.next(r))}catch(c){h(c)}}function u(r){try{a(t.throw(r))}catch(c){h(c)}}function a(r){r.done?s(r.value):i(r.value).then(f,u)}a((t=t.apply(d,n||[])).next())})};function U(d){return X(this,void 0,void 0,function*(){try{return yield d.request({method:"wallet_getSnaps"}),!0}catch{return!1}})}function he(){return X(this,void 0,void 0,function*(){try{const d=window.ethereum;if(!d)return null;if(d.providers&&Array.isArray(d.providers)){const n=d.providers;for(const e of n)if(yield U(e))return e}if(d.detected&&Array.isArray(d.detected)){const n=d.detected;for(const e of n)if(yield U(e))return e}return(yield U(d))?d:null}catch(d){return console.error(d),null}})}const fe="solana:mainnet",ue="solana:devnet",ve="solana:testnet",_e="solana:localnet",Y=[fe,ue,ve,_e];function R(d){return Y.includes(d)}var T=function(d,n,e,t){if(e==="a"&&!t)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?d!==n||!t:!n.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?t:e==="a"?t.call(d):t?t.value:n.get(d)},C=function(d,n,e,t,i){if(t==="m")throw new TypeError("Private method is not writable");if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?d!==n||!i:!n.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t==="a"?i.call(d,e):i?i.value=e:n.set(d,e),e},K,O,k,N,L,W;const me=Y,pe=[ee,te,ne];class q{get address(){return T(this,K,"f")}get publicKey(){return T(this,O,"f").slice()}get chains(){return T(this,k,"f").slice()}get features(){return T(this,N,"f").slice()}get label(){return T(this,L,"f")}get icon(){return T(this,W,"f")}constructor({address:n,publicKey:e,label:t,icon:i}){K.set(this,void 0),O.set(this,void 0),k.set(this,void 0),N.set(this,void 0),L.set(this,void 0),W.set(this,void 0),new.target===q&&Object.freeze(this),C(this,K,n,"f"),C(this,O,e,"f"),C(this,k,me,"f"),C(this,N,pe,"f"),C(this,L,t,"f"),C(this,W,i,"f")}}K=new WeakMap,O=new WeakMap,k=new WeakMap,N=new WeakMap,L=new WeakMap,W=new WeakMap;var E=function(d,n,e,t){function i(s){return s instanceof e?s:new e(function(h){h(s)})}return new(e||(e=Promise))(function(s,h){function f(r){try{a(t.next(r))}catch(c){h(c)}}function u(r){try{a(t.throw(r))}catch(c){h(c)}}function a(r){r.done?s(r.value):i(r.value).then(f,u)}a((t=t.apply(d,n||[])).next())})};class D extends oe{constructor(n){super(),this._network="mainnet-beta",this._iframeParams={},this._element=null,this._iframe=null,this._publicKey=null,this._account=null,this._isConnected=!1,this._connectHandler=null,this._messageHandlers={},this._handleEvent=e=>{var t,i;switch(e.type){case"connect":{this._collapseIframe(),!((t=e.data)===null||t===void 0)&&t.publicKey?(this._publicKey=e.data.publicKey,this._isConnected=!0,this._connectHandler&&(this._connectHandler.resolve(),this._connectHandler=null),this._connected()):(this._connectHandler&&(this._connectHandler.reject(),this._connectHandler=null),this._disconnected());return}case"disconnect":{this._connectHandler&&(this._connectHandler.reject(),this._connectHandler=null),this._disconnected();return}case"accountChanged":{!((i=e.data)===null||i===void 0)&&i.publicKey?(this._publicKey=e.data.publicKey,this.emit("accountChanged",this.publicKey),this._standardConnected()):(this.emit("accountChanged",void 0),this._standardDisconnected());return}default:return}},this._handleResize=e=>{e.resizeMode==="full"?e.params.mode==="fullscreen"?this._expandIframe():e.params.mode==="hide"&&this._collapseIframe():e.resizeMode==="coordinates"&&this._resizeIframe(e.params)},this._handleMessage=e=>{var t;if(((t=e.data)===null||t===void 0?void 0:t.channel)!=="solflareIframeToWalletAdapter")return;const i=e.data.data||{};if(i.type==="event")this._handleEvent(i.event);else if(i.type==="resize")this._handleResize(i);else if(i.type==="response"&&this._messageHandlers[i.id]){const{resolve:s,reject:h}=this._messageHandlers[i.id];delete this._messageHandlers[i.id],i.error?h(i.error):s(i.result)}},this._removeElement=()=>{this._element&&(this._element.remove(),this._element=null)},this._removeDanglingElements=()=>{const e=document.getElementsByClassName("solflare-metamask-wallet-adapter-iframe");for(const t of e)t.parentElement&&t.remove()},this._injectElement=()=>{this._removeElement(),this._removeDanglingElements();const e=Object.assign(Object.assign({},this._iframeParams),{mm:!0,v:1,cluster:this._network||"mainnet-beta",origin:window.location.origin||"",title:document.title||""}),t=Object.keys(e).map(s=>`${s}=${encodeURIComponent(e[s])}`).join("&"),i=`${D.IFRAME_URL}?${t}`;this._element=document.createElement("div"),this._element.className="solflare-metamask-wallet-adapter-iframe",this._element.innerHTML=`
      <iframe src='${i}' style='position: fixed; top: 0; bottom: 0; left: 0; right: 0; width: 100%; height: 100%; border: none; border-radius: 0; z-index: 99999; color-scheme: auto;' allowtransparency='true'></iframe>
    `,document.body.appendChild(this._element),this._iframe=this._element.querySelector("iframe"),window.addEventListener("message",this._handleMessage,!1)},this._collapseIframe=()=>{this._iframe&&(this._iframe.style.top="",this._iframe.style.right="",this._iframe.style.height="2px",this._iframe.style.width="2px")},this._expandIframe=()=>{this._iframe&&(this._iframe.style.top="0px",this._iframe.style.bottom="0px",this._iframe.style.left="0px",this._iframe.style.right="0px",this._iframe.style.width="100%",this._iframe.style.height="100%")},this._resizeIframe=e=>{this._iframe&&(this._iframe.style.top=isFinite(e.top)?`${e.top}px`:"",this._iframe.style.bottom=isFinite(e.bottom)?`${e.bottom}px`:"",this._iframe.style.left=isFinite(e.left)?`${e.left}px`:"",this._iframe.style.right=isFinite(e.right)?`${e.right}px`:"",this._iframe.style.width=isFinite(e.width)?`${e.width}px`:e.width,this._iframe.style.height=isFinite(e.height)?`${e.height}px`:e.height)},this._sendIframeMessage=e=>{if(!this.connected||!this.publicKey)throw new Error("Wallet not connected");return new Promise((t,i)=>{var s,h;const f=re();this._messageHandlers[f]={resolve:t,reject:i},(h=(s=this._iframe)===null||s===void 0?void 0:s.contentWindow)===null||h===void 0||h.postMessage({channel:"solflareWalletAdapterToIframe",data:Object.assign({id:f},e)},"*")})},this._connected=()=>{this._isConnected=!0,this.emit("connect",this.publicKey),this._standardConnected()},this._disconnected=()=>{this._publicKey=null,this._isConnected=!1,window.removeEventListener("message",this._handleMessage,!1),this._removeElement(),this.emit("disconnect"),this._standardDisconnected()},this._standardConnected=()=>{if(!this.publicKey)return;const e=this.publicKey.toString();(!this._account||this._account.address!==e)&&(this._account=new q({address:e,publicKey:this.publicKey.toBytes()}),this.emit("standard_change",{accounts:this.standardAccounts}))},this._standardDisconnected=()=>{this._account&&(this._account=null,this.emit("standard_change",{accounts:this.standardAccounts}))},n?.network&&(this._network=n?.network),window.SolflareMetaMaskParams&&(this._iframeParams=Object.assign(Object.assign({},this._iframeParams),window.SolflareMetaMaskParams)),n?.params&&(this._iframeParams=Object.assign(Object.assign({},this._iframeParams),n?.params))}get publicKey(){return this._publicKey?new ie(this._publicKey):null}get standardAccount(){return this._account}get standardAccounts(){return this._account?[this._account]:[]}get isConnected(){return this._isConnected}get connected(){return this.isConnected}get autoApprove(){return!1}connect(){return E(this,void 0,void 0,function*(){this.connected||(this._injectElement(),yield new Promise((n,e)=>{this._connectHandler={resolve:n,reject:e}}))})}disconnect(){return E(this,void 0,void 0,function*(){yield this._sendIframeMessage({method:"disconnect"}),this._disconnected()})}signTransaction(n){var e;return E(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw new Error("Wallet not connected");try{const t=P(n),i=yield this._sendIframeMessage({method:"signTransactionV2",params:{transaction:A.encode(t)}}),{transaction:s}=i;return $(n)?V.from(A.decode(s)):I.deserialize(A.decode(s))}catch(t){throw new Error(((e=t?.toString)===null||e===void 0?void 0:e.call(t))||"Failed to sign transaction")}})}signAllTransactions(n){var e;return E(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw new Error("Wallet not connected");try{const t=n.map(s=>P(s)),{transactions:i}=yield this._sendIframeMessage({method:"signAllTransactionsV2",params:{transactions:t.map(s=>A.encode(s))}});return i.map((s,h)=>$(n[h])?V.from(A.decode(s)):I.deserialize(A.decode(s)))}catch(t){throw new Error(((e=t?.toString)===null||e===void 0?void 0:e.call(t))||"Failed to sign transactions")}})}signAndSendTransaction(n,e){var t;return E(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw new Error("Wallet not connected");try{const i=P(n),{signature:s}=yield this._sendIframeMessage({method:"signAndSendTransaction",params:{transaction:A.encode(i),options:e}});return s}catch(i){throw new Error(((t=i?.toString)===null||t===void 0?void 0:t.call(i))||"Failed to sign and send transaction")}})}signMessage(n,e="utf8"){var t;return E(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw new Error("Wallet not connected");try{const{signature:i}=yield this._sendIframeMessage({method:"signMessage",params:{data:A.encode(n),display:e}});return Uint8Array.from(A.decode(i))}catch(i){throw new Error(((t=i?.toString)===null||t===void 0?void 0:t.call(i))||"Failed to sign message")}})}sign(n,e="utf8"){return E(this,void 0,void 0,function*(){return yield this.signMessage(n,e)})}static isSupported(){return E(this,void 0,void 0,function*(){return!!(yield he())})}standardSignAndSendTransaction(...n){return E(this,void 0,void 0,function*(){if(!this.connected)throw new Error("not connected");const e=[];if(n.length===1){const{transaction:t,account:i,chain:s,options:h}=n[0],{minContextSlot:f,preflightCommitment:u,skipPreflight:a,maxRetries:r}=h||{};if(i!==this._account)throw new Error("invalid account");if(!R(s))throw new Error("invalid chain");const c=yield this.signAndSendTransaction(I.deserialize(t),{preflightCommitment:u,minContextSlot:f,maxRetries:r,skipPreflight:a});e.push({signature:A.decode(c)})}else if(n.length>1)for(const t of n)e.push(...yield this.standardSignAndSendTransaction(t));return e})}standardSignTransaction(...n){return E(this,void 0,void 0,function*(){if(!this.connected)throw new Error("not connected");const e=[];if(n.length===1){const{transaction:t,account:i,chain:s}=n[0];if(i!==this._account)throw new Error("invalid account");if(s&&!R(s))throw new Error("invalid chain");const h=yield this.signTransaction(I.deserialize(t));e.push({signedTransaction:h.serialize()})}else if(n.length>1){let t;for(const h of n){if(h.account!==this._account)throw new Error("invalid account");if(h.chain){if(!R(h.chain))throw new Error("invalid chain");if(t){if(h.chain!==t)throw new Error("conflicting chain")}else t=h.chain}}const i=n.map(({transaction:h})=>I.deserialize(h)),s=yield this.signAllTransactions(i);e.push(...s.map(h=>({signedTransaction:h.serialize()})))}return e})}standardSignMessage(...n){return E(this,void 0,void 0,function*(){if(!this.connected)throw new Error("not connected");const e=[];if(n.length===1){const{message:t,account:i}=n[0];if(i!==this._account)throw new Error("invalid account");const s=yield this.signMessage(t);e.push({signedMessage:t,signature:s})}else if(n.length>1)for(const t of n)e.push(...yield this.standardSignMessage(t));return e})}}D.IFRAME_URL="https://widget.solflare.com/";export{q as StandardSolflareMetaMaskWalletAccount,D as default};
//# sourceMappingURL=index-lBUBF3dD.js.map
